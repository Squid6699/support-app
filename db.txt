-- Tabla de roles
CREATE TABLE Rol (
    id SERIAL PRIMARY KEY,
    nombre VARCHAR(50) NOT NULL
);

-- Tabla de personas
CREATE TABLE Persona (
    id SERIAL PRIMARY KEY,
    nombre VARCHAR(100) NOT NULL,
    celular VARCHAR(20),
    correo VARCHAR(100) UNIQUE NOT NULL,
    contraseña VARCHAR(100) NOT NULL,
    rol_id INT REFERENCES Rol(id)
);

-- Tabla de prioridades
CREATE TABLE Prioridad (
    id SERIAL PRIMARY KEY,
    nombre VARCHAR(50) NOT NULL
);

-- Tabla de marcas
CREATE TABLE Marca (
    id SERIAL PRIMARY KEY,
    nombre VARCHAR(100) NOT NULL
);

-- Tabla de tipos de equipos (se necesitaba crear antes de Equipo)
CREATE TABLE TipoEquipo (
    id SERIAL PRIMARY KEY,
    nombre VARCHAR(100) NOT NULL
);

-- Tabla de ubicación
CREATE TABLE Ubicacion (
    id SERIAL PRIMARY KEY,
    edificio VARCHAR(100) NOT NULL,
    aula VARCHAR(100) NOT NULL,
    persona_id INT REFERENCES Persona(id)
);

-- Tabla de equipos
CREATE TABLE Equipo (
    id SERIAL PRIMARY KEY,
    nombre VARCHAR(100) NOT NULL,
    fecha DATE,
    ubicacion_id INT REFERENCES Ubicacion(id),
    marca_id INT REFERENCES Marca(id),
    tipo_id INT REFERENCES TipoEquipo(id)
);

-- Tabla de piezas
CREATE TABLE Pieza (
    id SERIAL PRIMARY KEY,
    nombre VARCHAR(100) NOT NULL,
    fecha DATE,
    marca_id INT REFERENCES Marca(id)
);

-- Relación N:M entre equipos y piezas
CREATE TABLE Equipo_Pieza (
    equipo_id INT REFERENCES Equipo(id),
    pieza_id INT REFERENCES Pieza(id),
    PRIMARY KEY (equipo_id, pieza_id)
);

-- Tabla de servicios (se pone después porque necesita Persona ya creada)
CREATE TABLE Servicio (
    id SERIAL PRIMARY KEY,
    nombre VARCHAR(100) NOT NULL,
    descripcion TEXT NOT NULL,
    tecnico_id INT REFERENCES Persona(id),
    horas INT
);

-- ENUM para estado de incidentes
CREATE TYPE estado_incidente AS ENUM ('NO INICIADO', 'EN PROCESO', 'TERMINADO', 'LIBERADO');

-- Tabla de incidentes
CREATE TABLE Incidente (
    id SERIAL PRIMARY KEY,
    fecha DATE,
    descripcion VARCHAR(100) NOT NULL,
    usuario_id INT REFERENCES Persona(id),
    tecnico_id INT REFERENCES Persona(id),
    equipo_id INT REFERENCES Equipo(id),
    prioridad_id INT REFERENCES Prioridad(id),
    servicio_id INT REFERENCES Servicio(id),
    finalizado BOOLEAN DEFAULT false,
    calificacion INT DEFAULT 0,
    autorizada BOOLEAN DEFAULT false,
    estado estado_incidente DEFAULT 'NO INICIADO' NOT NULL
);




INSERT INTO Rol (nombre) VALUES
('Administrador'),
('Tecnico Hardware'),
('Tecnico Software'),
('Encargado Edificio');


INSERT INTO Prioridad (nombre) VALUES
('Alta'),
('Media'),
('Baja'),
('Preventiva');


INSERT INTO Marca (nombre) VALUES
('Dell'),
('HP'),
('Lenovo'),
('Asus'),
('Logitech');


INSERT INTO TipoEquipo (nombre) VALUES
('Laptop'),
('Proyector'),
('Impresora'),
('Servidor'),
('PC Escritorio');


INSERT INTO Persona (nombre, celular, correo, contraseña, rol_id) VALUES
('Carlos Pérez', '5551234567', 'carlos.perez@uni.edu', 'pass123', 1), -- Admin
('Ana Torres', '5559876543', 'ana.torres@uni.edu', 'pass123', 2), -- Técnico HW
('Luis Gómez', '5553217890', 'luis.gomez@uni.edu', 'pass123', 3), -- Técnico SW
('Marta López', '5556543210', 'marta.lopez@uni.edu', 'pass123', 4); -- Encargada


INSERT INTO Ubicacion (edificio, aula, persona_id) VALUES
('Edificio A', 'Aula 101', 4),
('Edificio A', 'Aula 102', 4),
('Edificio B', 'Lab 201', 4);


INSERT INTO Equipo (nombre, fecha, ubicacion_id, marca_id, tipo_id) VALUES
('Laptop Docente 1', '2024-01-15', 1, 1, 1),
('Proyector Aula 102', '2023-05-20', 2, 2, 2),
('Impresora Lab 201', '2022-11-10', 3, 3, 3),
('Servidor Principal', '2021-07-01', 3, 4, 4);


INSERT INTO Pieza (nombre, fecha, marca_id) VALUES
('Disco Duro 1TB', '2024-03-01', 1),
('Memoria RAM 16GB', '2024-02-20', 2),
('Fuente de Poder 600W', '2024-01-10', 3),
('Tarjeta Madre ATX', '2023-12-15', 4),
('Mouse Inalámbrico', '2024-04-05', 5);


INSERT INTO Equipo_Pieza (equipo_id, pieza_id) VALUES
(1, 1),
(1, 2),
(3, 3),
(4, 4),
(1, 5);


INSERT INTO Servicio (nombre, descripcion, tecnico_id, horas) VALUES
('Mantenimiento Correctivo', 'Reparación de fallas en hardware', 2, 5),
('Instalación de Software', 'Instalación de sistemas y aplicaciones', 3, 3),
('Revisión Preventiva', 'Chequeo general de equipos', 2, 2);


INSERT INTO Incidente (fecha, descripcion, usuario_id, tecnico_id, equipo_id, prioridad_id, servicio_id, finalizado, calificacion, autorizada, estado) VALUES
('2024-06-01', 'Laptop no enciende', 1, 2, 1, 1, 1, false, 0, false, 'NO INICIADO'),
('2024-06-05', 'Proyector sin señal', 1, 3, 2, 2, 2, false, 0, false, 'EN PROCESO'),
('2024-06-10', 'Impresora atascada', 1, 2, 3, 3, 1, true, 4, true, 'TERMINADO'),
('2024-06-15', 'Servidor requiere actualización', 1, 3, 4, 4, 3, false, 0, false, 'NO INICIADO');
